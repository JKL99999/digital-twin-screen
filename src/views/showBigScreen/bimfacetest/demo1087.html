<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>加载多模型</title>
    <style media="screen">
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
        }

        .buttons {
            font-size: 0;
        }

        .button {
            margin: 5px 0 5px 5px;
            width: 100px;
            height: 30px;
            border-radius: 3px;
            border: none;
            background: #32D3A6;
            color: #FFFFFF;
            outline: none;
        }

        .main {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
        }

        #domId {
            flex: 1;
        }
    </style>
    <!-- 引用BIMFACE的JavaScript显示组件库 -->
    <script src="https://static.bimface.com/api/BimfaceSDKLoader/BimfaceSDKLoader@latest-release.js"
        charset="utf-8"></script>
</head>

<body>
    <div class='main'>
        <div class='buttons'>
            <button class="button" id="btnAddModel" onclick="addModel()">加载模型</button>
            <button class="button" id="btnMoveModel" onclick="moveModel()">平移模型</button>
            <button class="button" id="btnRotateModel" onclick="rotateModel()">旋转模型</button>
            <button class="button" id="btnScaleModel" onclick="scaleModel()">缩放模型</button>
        </div>
        <!-- 定义DOM元素，用于在该DOM元素中显示模型或图纸 -->
        <div class='model' id="domId"></div>
    </div>
    <script type="text/javascript">
        let viewToken = 'aa06be3f22f245468a0dc17c5a78ec67';
        // 声明Viewer及App
        let viewer3D;
        let app;
        let viewAdded = false;
        let modelId = "10000776931924";
        let modelId_2 = modelId + "_2"
        let model3D;
        // 初始化显示组件
        let options = new BimfaceSDKLoaderConfig();
        options.viewToken = viewToken;
        BimfaceSDKLoader.load(options, successCallback, failureCallback);
        function successCallback(viewMetaData) {
            if (viewMetaData.viewType == "3DView") {
                // ======== 判断是否为3D模型 ========        
                // 获取DOM元素
                let dom4Show = document.getElementById("domId");
                let webAppConfig = new Glodon.Bimface.Application.WebApplication3DConfig();
                webAppConfig.domElement = dom4Show;
                // 设置全局单位
                webAppConfig.globalUnit = Glodon.Bimface.Common.Units.LengthUnits.Millimeter;
                // 默认开启阴影
                webAppConfig.enableCSMShadow= true;
                // 创建WebApplication
                app = new Glodon.Bimface.Application.WebApplication3D(webAppConfig);
                // 从WebApplication获取viewer3D对象
                viewer3D = app.getViewer();
                // 添加待显示的模型
                viewer3D.loadModel({
                    // 待加载模型的浏览凭证
                    viewToken: viewToken
                });
                // 监听添加view完成的事件
                viewer3D.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.ViewAdded, function () {
                    viewAdded = true;
                    //自适应屏幕大小
                    window.onresize = function () {
                        viewer3D.resize(document.documentElement.clientWidth, document.documentElement.clientHeight - 40);
                    }
                    // 渲染3D模型
                    viewer3D.render();
                });
                // 添加模型加载完成的监听事件，对加载的模型进行初始位置移动
                viewer3D.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.ModelAdded, function (data) {
                    //从viewer3D对象中获取模型对象model3D
                    model3D = viewer3D.getModel(modelId_2);
                    if(model3D){
                    // 平移模型
                    model3D.setModelTranslation({ x: 40000, y: 0, z: 0 });
                    console.log("modelId:" + data);
                    }
                });
            }
        }
        function failureCallback(error) {
            console.log(error);
        }

        // 根据viewToken加载指定模型
        let isModelAdded = false;
        function addModel() {
            if (!viewAdded || isModelAdded) {
                return;
            }
            viewer3D.loadModel({
                // 待加载模型的浏览凭证
                viewToken: "6c97b5d4700d46f5810b8c48af7d6a00",
                // 自定义模型ID，默认为文件ID
                modelId: modelId_2
            });
           
            isModelAdded = true;
        }

        // 平移模型
        function moveModel() {
            if (!viewAdded || !isModelAdded) {
                return;
            }
            model3D.setModelTranslation({ x: 10000, y: 0, z: 0 });
            console.log("modelId_2:" , viewer3D);
            //删除场景
            viewer3D.removeModel(modelId_2);
             isModelAdded = false;
            viewer3D.render();
        }

        // 基于世界坐标中的某个点，将模型绕z轴旋转
        function rotateModel() {
            if (!viewAdded || !isModelAdded) {
                return;
            }
            model3D.setModelRotationZ({ x: 50000, y: -2000, z: 0 }, -Math.PI / 2);
            viewer3D.render();
        }

        // 基于世界坐标中的某个点，将模型进行整体缩放
        function scaleModel() {
            if (!viewAdded || !isModelAdded) {
                return;
            }
            model3D.setModelScale({ x: 50000, y: -2000, z: 0 }, 0.12);
            viewer3D.render();
        }

        // 按钮文字
        function setButtonText(btnId, text) {
            let dom = document.getElementById(btnId);
            if (dom != null && dom.nodeName == "BUTTON") {
                dom.innerText = text;
            }
        }
    </script>
</body>

</html>